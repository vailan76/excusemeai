'use client';

import {
  Card,
  CardContent,
  CardFooter,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Copy, Download, Share2 } from 'lucide-react';
import { useToast } from '@/hooks/use-toast';

type ExcuseResultCardProps = {
  excuse: string;
  watermark: boolean;
};

export default function ExcuseResultCard({ excuse, watermark }: ExcuseResultCardProps) {
  const { toast } = useToast();
  const fullExcuse = watermark ? `${excuse}\n\nGenerated by ExcuseForge AI` : excuse;

  const handleCopy = () => {
    navigator.clipboard.writeText(fullExcuse);
    toast({
      title: 'Copied to clipboard!',
      description: 'You can now paste the excuse anywhere you need.',
    });
  };

  const handleDownload = () => {
    const blob = new Blob([fullExcuse], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'excuse.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  };

  const handleShare = () => {
    if (navigator.share) {
      navigator
        .share({
          title: 'My Excuse from ExcuseForge AI',
          text: fullExcuse,
        })
        .catch((error) => console.log('Error sharing', error));
    } else {
      // Fallback for browsers that do not support Web Share API
      handleCopy();
      toast({
        title: 'Sharing not supported',
        description: 'Excuse copied to clipboard instead.',
      });
    }
  };

  return (
    <Card>
      <CardHeader>
        <CardTitle className="font-headline">Your Generated Excuse</CardTitle>
      </CardHeader>
      <CardContent>
        <p className="whitespace-pre-wrap rounded-md bg-muted p-4 text-card-foreground">
          {excuse}
        </p>
        {watermark && (
          <p className="mt-4 text-center text-xs italic text-muted-foreground/80">
            Generated by ExcuseForge AI
          </p>
        )}
      </CardContent>
      <CardFooter className="flex-col gap-4 sm:flex-row sm:justify-end sm:gap-2">
        <Button variant="outline" onClick={handleCopy}>
          <Copy className="mr-2 h-4 w-4" />
          Copy
        </Button>
        <Button variant="outline" onClick={handleShare}>
          <Share2 className="mr-2 h-4 w-4" />
          Share
        </Button>
        <Button variant="outline" onClick={handleDownload}>
          <Download className="mr-2 h-4 w-4" />
          Download
        </Button>
      </CardFooter>
    </Card>
  );
}
